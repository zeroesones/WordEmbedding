import fitz  # PyMuPDF
import re
import os

def extract_coper_id(page_text):
    # Extract the "Our Reference: " followed by a number
    match = re.search(r'Our Reference:\s*(\d+)', page_text)
    
    if match:
        coper_id = match.group(1).strip()  # Extracted number without padded spaces
        return coper_id
    else:
        return None

def split_pdf_to_individual_pages(pdf_file_path, output_folder):
    if not os.path.exists(output_folder):
        os.makedirs(output_folder)

    pdf_document = fitz.open(pdf_file_path)

    # Get the total number of pages in the document
    total_pages = pdf_document.page_count

    for page_number in range(total_pages):
        page = pdf_document.load_page(page_number)
        page_text = page.get_text()

        coper_id = extract_coper_id(page_text)

        if coper_id:
            output_file_path = os.path.join(output_folder, f"{coper_id}.pdf")
            
            # Create a new PDF document with a single page
            new_document = fitz.open()
            new_page = new_document.new_page(width=page.width, height=page.height)
            
            # Copy the content from the original page to the new page
            new_page.show_pdf_page(page.rect, pdf_document, page_number)
            
            # Save the new document with the corresponding name
            new_document.save(output_file_path)

def main():
    pdf_file_path = "your_input.pdf"  # Replace with the path to your PDF document
    output_folder = "output_pdfs"  # Folder where individual PDFs will be saved

    split_pdf_to_individual_pages(pdf_file_path, output_folder)
    
    print(f"PDFs split and saved to {output_folder}")

if __name__ == "__main__":
    main()
